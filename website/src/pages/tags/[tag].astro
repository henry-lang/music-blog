---
import Default from '../../layouts/Default.astro'
import RelatedArticles from '../../components/RelatedArticles.astro'
import PostFrontmatter from '../../util/PostFrontmatter'

export async function getStaticPaths(): Promise<{ params: { tag: string } }[]> {
    let result = [...new Set((await Astro.glob<PostFrontmatter>('../posts/*.md'))
        .flatMap(({ frontmatter: { tags } }) => tags))]
        .map(tag => { return { params: { tag } } })

    return result
}

let { tag } = Astro.params // Manually check getStaticPaths returns valid params (tag, etc)
---

<Default title={`Related articles to ${tag}`}>
    <RelatedArticles relatedTo={tag} predicate={(post: PostFrontmatter)=> post.tags.includes(tag!.toString())} />
</Default>