---
import RelatedArticles from '../../layouts/RelatedArticles.astro'
import PostFrontmatter from '../../util/PostFrontmatter'

export async function getStaticPaths() {
    let uniqueTags = new Set<string>()

    for (const post of (await Astro.glob<PostFrontmatter>("../posts/*.md"))) {
        for (const tag of post.frontmatter.tags) {
            uniqueTags.add(tag)
        }
    }

    return Array.from(uniqueTags).map(tag => { return { params: { name: tag } } })
}


let { name } = Astro.params // Manually check getStaticPaths ONLY returns valid params (name)
if (typeof name != 'string') { name = '' } // Astro has crappy typedefs :(
---

<RelatedArticles relatedTo={name} predicate={(post)=> post.tags.includes(name)} />